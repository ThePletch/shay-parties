import{$ as e}from"./jquery-CbzS8guM.js";class g{constructor(i){this.image=i,this.rawYOffset=-this.image.data("initial-y-offset"),this.dragging=!1,this.imageLoaded=!1,this.parentDiv=this.image.closest(".hero-image"),this.parentCollapsible=this.image.closest(".accordion"),this.parentDiv.on("mousedown",s=>{s.preventDefault(),this.dragging=!0}),this.parentDiv.on("mousemove",s=>{this.dragging&&this.imageLoaded&&this.shiftYOffset(s.originalEvent?.movementY??0)}),this.parentCollapsible.on("click",()=>{this.shiftYOffset(0)}),e(window).on("mouseup",()=>{this.dragging=!1}),e(window).on("resize",()=>{this.updateImageShift()})}get parentDivHeight(){return this.parentDiv.height()??0}scaleToNewImage(i,s=!1){this.imageLoaded=!1;const a=new Image;a.onload=()=>{this.rawDimensions={height:a.height,width:a.width},s||(this.rawYOffset=0),this.shiftYOffset(0),this.imageLoaded=!0},a.src=i}heightShiftRange(){if(!this.rawDimensions)throw new Error("Image not loaded yet");return this.rawDimensions.height-this.parentDivHeight/this.imageScaleFactor()}shiftYOffset(i){this.imageScaleFactor()!==0&&(this.rawYOffset=Math.min(Math.max(-this.heightShiftRange(),this.rawYOffset+i/this.imageScaleFactor()),0),e("#event_photo_crop_y_offset").val(Math.round(-this.rawYOffset)),this.updateImageShift())}updateImageShift(){this.image.css({objectPosition:"0px "+this.rawYOffset*this.imageScaleFactor()+"px"})}imageScaleFactor(){return(this.parentDiv.width()??0)/(this.rawDimensions?.width??1)}scaledImageHeight(){return(this.rawDimensions?.height??0)*this.imageScaleFactor()}}e(function(){e("#crop-prompt, #crop-instruction").hide();function n(t){const o=e("#title-preview");t?o.html(t):o.html(o.data("default"))}e("#event_title").on("keyup",t=>{n(e(t.target).val()?.toString()??"")}),n(e("#event_title").val()?.toString()??"");function i(t){e("#requires-testing").toggle(t)}e("#event_requires_testing").on("change",t=>{i(t.target.checked)}),i(e("#event_requires_testing").prop("checked"));const s=new g(e("#photo-preview"));function a(t,o=!1){if(t.files!=null&&t.files.length>0){const r=URL.createObjectURL(t.files[0]);s.scaleToNewImage(r,o),e("#crop-prompt, #crop-instruction").show(),e("#photo-preview").attr("src",r)}else{const r=e("#photo-preview").attr("src");if(!r)throw new Error("Tried to scale to null image");s.scaleToNewImage(r,o),e("#crop-prompt, #crop-instruction").hide()}}e('input[type="file"]#event_photo').on("change",t=>{a(t.target,!1)});const[h]=e('input[type="file"]#event_photo');h&&a(h,!0)});
