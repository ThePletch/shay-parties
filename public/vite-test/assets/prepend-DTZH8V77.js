import{$ as i}from"./jquery-CbzS8guM.js";class d{constructor(e,t){this.deleteHook=t,this.element=i(e),this.initializeDeleteButton()}static fromTemplate(e,t,n){const a=i(e),c=new Date().getTime(),s=o=>{const r=i(o);Object.entries({[t]:["name","id","for","data-form-prepend"],_timestamp_:["id","class","data-dynamic-target-id","data-target"]}).forEach(([p,u])=>{u.forEach(l=>{r.attr(l,()=>{const h=r.attr(l);if(h!=null)return h.replaceAll(p,c.toString())})})})};return a.find("*").each((o,r)=>s(r)),s(a),new d(a,n)}deleteEvent(e){this.deleteHook&&this.deleteHook(e)}initializeDeleteButton(){const e=this.element.find(".dynamic-list-delete");e.on("click",()=>{if(!this.element.data("persisted"))this.element.remove(),this.deleteEvent("deleted");else{const t=this.element.data("remove");this.element.data("remove",!t),this.element.find('input[type!="hidden"]').attr("disabled",(!t).toString()),this.element.find("input.destroy").val(+!t),t?(this.element.find("input").removeClass("text-decoration-line-through"),e.removeClass("btn-primary"),e.addClass("btn-danger"),e.html("X"),this.deleteEvent("undeleted")):(this.element.find("input").addClass("text-decoration-line-through"),e.removeClass("btn-danger"),e.addClass("btn-primary"),e.html("+"),this.deleteEvent("markedForDeletion"))}})}}class f{constructor(e){if(this.addButton=i("#"+e),this.recordLimit=this.addButton.data("record-limit"),this.targetElement=i(this.addButton.data("target")),this.prependTemplate=this.addButton.data("form-prepend"),this.prependTemplate==null)throw new Error(`No data-form-prepend attribute found on record add button for ID #${e}. This is necessary to add new records.`);if(this.childIndexPlaceholder=this.addButton.data("prepend-child-index"),this.childIndexPlaceholder==null)throw new Error(`No data-prepend-child-index attribute found on record add button for ID #${e}. This is necessary to properly template new records.`);this.addButton.on("click",()=>{this.targetElement.append(d.fromTemplate(this.prependTemplate,this.childIndexPlaceholder,this.enforceListLimit.bind(this)).element),this.enforceListLimit()}),this.targetElement.children().each((t,n)=>{new d(i(n),this.enforceListLimit.bind(this))}),this.enforceListLimit()}enforceListLimit(){if(this.recordLimit==null||this.recordLimit==-1)return;this.targetElement.children().filter((t,n)=>!i(n).data("remove")).length>=this.recordLimit?this.addButton.addClass("disabled"):this.addButton.removeClass("disabled")}}function v(){i(()=>{i("[data-form-prepend]").each((m,e)=>{new f(e.id)})})}export{v as i};
